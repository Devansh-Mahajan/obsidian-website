---
import NotesLayout from '../layouts/NotesLayout.astro';
import { getCollection } from 'astro:content';

const notes = (await getCollection('notes'))
    .filter(note => note.data.publish !== false)
    .sort((a, b) => {
        const aTime = a.data.updated_date?.getTime?.() || a.data.created_date?.getTime?.() || 0;
        const bTime = b.data.updated_date?.getTime?.() || b.data.created_date?.getTime?.() || 0;
        return bTime - aTime;
    });
---

<NotesLayout title="Study Notes" description="Published study notes from my Obsidian vault.">
    <div style="margin-bottom: 2rem;">
        <h1 style="margin-bottom: 0.5rem; color: var(--obsidian-text);">Study Notes</h1>
        <p style="color: var(--obsidian-text-secondary); margin: 0;">Curated notes from my Obsidian vault</p>
    </div>
    
    {notes.length > 0 ? (
        <div style="display: grid; gap: 1rem;">
            {notes.map((note) => (
                <a 
                    href={("/notes/" + (note.data.slug || note.id.replace(/\.[^/.]+$/, '')))}
                    style="
                        display: block;
                        padding: 1rem;
                        background: var(--obsidian-bg-tertiary);
                        border: 1px solid var(--obsidian-border);
                        border-radius: 0.5rem;
                        text-decoration: none;
                        color: var(--obsidian-text);
                        transition: all 0.2s ease;
                    "
                    onmouseover="this.style.background='var(--obsidian-hover)'; this.style.borderColor='var(--obsidian-accent)'"
                    onmouseout="this.style.background='var(--obsidian-bg-tertiary)'; this.style.borderColor='var(--obsidian-border)'"
                >
                    <h3 style="margin: 0 0 0.5rem 0; color: var(--obsidian-text); font-size: 1.1rem;">
                        {note.data.title || note.id.split('/').pop()?.replace(/-/g, ' ').replace(/_/g, ' ')}
                    </h3>
                    {note.data.description && (
                        <p style="margin: 0; color: var(--obsidian-text-secondary); font-size: 0.9rem;">
                            {note.data.description}
                        </p>
                    )}
                </a>
            ))}
        </div>
    ) : (
        <div style="
            text-align: center;
            padding: 3rem 2rem;
            background: var(--obsidian-bg-tertiary);
            border: 1px solid var(--obsidian-border);
            border-radius: 0.75rem;
            color: var(--obsidian-text-secondary);
        ">
            <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“š</div>
            <h3 style="margin: 0 0 1rem 0; color: var(--obsidian-text); font-size: 1.25rem;">
                No Study Notes Yet
            </h3>
            <p style="margin: 0; line-height: 1.6;">
                Study notes will appear here once you add content to your specified Obsidian folders:<br/>
                <strong>200 ETH Zurich</strong>, <strong>300 IMO + Putnam</strong>, <strong>500 Books</strong>, <strong>700 Quant</strong>, <strong>800 Projects</strong>, <strong>998 Images</strong>
            </p>
        </div>
    )}
</NotesLayout>

